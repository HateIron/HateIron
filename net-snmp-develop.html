<!doctype html>
<html lang='en'>
<head>
<meta charset='utf-8'>
<title>net-snmp-develop.md</title><link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css'><style type='text/css'>html, body {overflow-x: initial !important;}.CodeMirror { height: auto; }
.CodeMirror-scroll { overflow-y: hidden; overflow-x: auto; }
.CodeMirror-lines { padding: 4px 0px; }
.CodeMirror pre { }
.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: white; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); white-space: nowrap; background-color: rgb(247, 247, 247); }
.CodeMirror-linenumbers { }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.CodeMirror div.CodeMirror-cursor { border-left-width: 1px; border-left-style: solid; border-left-color: black; z-index: 3; }
.CodeMirror div.CodeMirror-secondarycursor { border-left-width: 1px; border-left-style: solid; border-left-color: silver; }
.CodeMirror.cm-keymap-fat-cursor div.CodeMirror-cursor { width: auto; border: 0px; z-index: 1; background: rgb(119, 238, 119); }
.CodeMirror div.CodeMirror-cursor.CodeMirror-overwrite { }
.cm-tab { display: inline-block; }
.cm-s-typora-default .cm-header, .cm-s-typora-default .cm-property { color: rgb(217, 79, 138); }
.cm-s-typora-default pre.cm-header1:not(.cm-atom) :not(.cm-overlay) { font-size: 2rem; line-height: 2rem; }
.cm-s-typora-default pre.cm-header2:not(.cm-atom) :not(.cm-overlay) { font-size: 1.4rem; line-height: 1.4rem; }
.cm-s-typora-default .cm-atom, .cm-s-typora-default .cm-number { color: rgb(149, 132, 134); }
.cm-s-typora-default .cm-table-row, .cm-s-typora-default .cm-block-start { font-family: monospace; }
.cm-s-typora-default .cm-comment { color: rgb(74, 90, 159); font-family: monospace; }
.cm-s-typora-default .cm-tag { color: rgb(169, 68, 66); }
.cm-s-typora-default .cm-string { color: rgb(126, 134, 169); }
.cm-s-typora-default .cm-link { color: rgb(196, 122, 15); text-decoration: underline; }
.cm-s-typora-default .cm-variable-2, .cm-s-typora-default .cm-variable-1 { color: inherit; }
.cm-s-typora-default .cm-overlay { font-size: 1rem; font-family: monospace; }
.CodeMirror.cm-s-typora-default div.CodeMirror-cursor { border-left-width: 3px; border-left-style: solid; border-left-color: rgb(228, 98, 154); }
.cm-s-typora-default .CodeMirror-activeline-background { left: -60px; right: -30px; background: rgba(204, 204, 204, 0.2); }
.cm-s-typora-default .CodeMirror-gutters { border-right-style: none; background-color: inherit; }
.cm-s-typora-default .cm-trailing-space-new-line::after, .cm-startspace::after, .cm-starttab .cm-tab::after { content: "•"; position: absolute; left: 0px; opacity: 0; font-family: LetterGothicStd, monospace; }
.os-windows .cm-startspace::after, .os-windows .cm-starttab .cm-tab::after { left: -0.1em; }
.cm-starttab .cm-tab::after { content: " "; }
.cm-startspace, .cm-tab, .cm-starttab, .cm-trailing-space-a, .cm-trailing-space-b, .cm-trailing-space-new-line { font-family: monospace; position: relative; }
.cm-s-typora-default .cm-trailing-space-new-line::after { content: "↓"; opacity: 0.3; }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: black; }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-property { color: black; }
.cm-s-inner .cm-operator { color: black; }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: blue; }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: bold; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: rgb(255, 0, 0); }
.cm-invalidchar { color: rgb(255, 0, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.CodeMirror-activeline-background { background: rgb(232, 242, 255); }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { margin-bottom: -30px; margin-right: -30px; padding-bottom: 30px; padding-right: 30px; height: 100%; outline: none; position: relative; box-sizing: content-box; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow-x: hidden; overflow-y: scroll; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow-y: hidden; overflow-x: scroll; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 30px; z-index: 3; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; word-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; background: transparent; }
.CodeMirror-wrap pre { word-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-style: none; width: auto; }
.CodeMirror-linebackground { position: absolute; left: 0px; right: 0px; top: 0px; bottom: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-widget { }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-style: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.CodeMirror-selected { background: rgb(217, 217, 217); }
.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
.CodeMirror span { }
@media print { 
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


html { font-size: 14px; }
body { margin: 0px; padding: 0px; height: auto; bottom: 0px; top: 0px; left: 0px; right: 0px; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; line-height: 1.42857; color: rgb(51, 51, 51); overflow-x: hidden; background-color: rgb(255, 255, 255); }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: rgb(181, 214, 252); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; word-wrap: break-word; position: relative; padding-bottom: 70px; white-space: pre-wrap; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export #write { margin: 0px auto; }
#write > p:first-child, #write > ul:first-child, #write > ol:first-child, #write > pre:first-child, #write > blockquote:first-child, #write > div:first-child, #write > table:first-child { margin-top: 30px; }
img { max-width: 100%; }
input, button, select, textarea { color: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
::before, ::after, * { box-sizing: border-box; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write div, #write pre { width: inherit; }
#write p, #write h1, #write h2, #write h3, #write h4, #write h5, #write h6 { position: relative; }
h1 { font-size: 2rem; }
p { -webkit-margin-before: 1rem; -webkit-margin-after: 1rem; -webkit-margin-start: 0px; -webkit-margin-end: 0px; }
.mathjax-block { margin-top: 0px; margin-bottom: 0px; -webkit-margin-before: 0rem; -webkit-margin-after: 0rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: bold; font-style: italic; }
a { cursor: pointer; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; margin: 4px 0px 0px; }
tr { page-break-inside: avoid; page-break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; page-break-inside: auto; }
table.md-table td { min-width: 80px; }
.CodeMirror-gutters { border-right-width: 0px; background-color: inherit; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
pre { white-space: pre-wrap; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences, pre.md-fences { font-size: 0.9rem; display: block; page-break-inside: avoid; text-align: left; overflow: visible; white-space: pre; position: relative !important; background: inherit; }
.md-fences .CodeMirror.CodeMirror-wrap { top: -1.6em; margin-bottom: -1.6em; }
.md-fences.mock-cm { white-space: pre-wrap; }
.show-fences-line-number pre.md-fences { padding-left: 0px; }
.show-fences-line-number pre.md-fences.mock-cm { padding-left: 40px; }
.footnotes { color: rgb(136, 136, 136); font-size: 0.9rem; padding-top: 1em; padding-bottom: 1em; }
.footnotes + .footnotes { margin-top: -1em; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; text-decoration: none; color: rgb(51, 51, 51); font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 1rem; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: normal; text-align: left; box-sizing: content-box; direction: ltr; background: transparent; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li p, li .mathjax-block { margin: 0.5rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; }
@media print { 
  html, body { height: 100%; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  h1, h2, h3, h4, h5, h6 { page-break-after: avoid; orphans: 2; }
  p { orphans: 4; }
  @page { margin: 20mm 0mm; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
#write pre.md-meta-block { font-size: 0.8rem; min-height: 2.86rem; white-space: pre-wrap; display: block; background: rgb(204, 204, 204); }
p > .md-image:only-child { display: inline-block; width: 100%; text-align: center; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.mathjax-block { white-space: pre; overflow: hidden; width: 100%; }
p + .mathjax-block { margin-top: -1.143rem; }
.mathjax-block:not(:empty)::after { display: none; }
[contenteditable="true"]:active, [contenteditable="true"]:focus { outline: none; box-shadow: none; }
.task-list { list-style-type: none; }
.task-list-item { position: relative; padding-left: 1em; }
.task-list-item input { position: absolute; top: 0px; left: 0px; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc::after, .md-toc-content::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: bold; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
.md-toc-h6 { margin-left: 12em; }
@media screen and (max-width: 48em) { 
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 8em; }
  .md-toc-h6 { margin-left: 9.5em; }
}
a.md-toc-inner { color: inherit; font-size: inherit; font-style: inherit; font-weight: inherit; text-decoration: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
.md-tag { opacity: 0.5; }
code { text-align: left; }
h1 .md-tag, h2 .md-tag, h3 .md-tag, h4 .md-tag, h5 .md-tag, h6 .md-tag { font-weight: initial; opacity: 0.35; }
a.md-header-anchor.md-print-anchor { border: none !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: none !important; text-decoration: initial !important; text-shadow: initial !important; background: transparent !important; }
.md-inline-math .MathJax_SVG .noError { display: none !important; }
.mathjax-block .MathJax_SVG_Display { text-align: center; margin: 1em 0em; position: relative; text-indent: 0px; max-width: none; max-height: none; min-width: 0px; min-height: 0px; width: 100%; display: block !important; }
.MathJax_SVG_Display, .md-inline-math .MathJax_SVG_Display { width: auto; margin: inherit; display: inline-block !important; }
.MathJax_SVG .MJX-monospace { font-family: monospace; }
.MathJax_SVG .MJX-sans-serif { font-family: sans-serif; }
.MathJax_SVG { display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; text-indent: 0px; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0px; min-height: 0px; border: 0px; padding: 0px; margin: 0px; }
.MathJax_SVG * { transition: none; }


@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: normal; src: local(Open Sans Regular), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/400.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: normal; src: local(Open Sans Italic), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/400i.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: normal; font-weight: bold; src: local(Open Sans Bold), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/700.woff) format(woff); }
@font-face { font-family: 'Open Sans'; font-style: italic; font-weight: bold; src: local(Open Sans Bold Italic), url(file:///C:/Users/Administrator/AppData/Roaming/Typora/themes/github/700i.woff) format(woff); }
html { font-size: 16px; }
body { font-family: 'Open Sans', 'Clear Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; color: rgb(51, 51, 51); line-height: 1.6; -webkit-font-smoothing: antialiased; }
#write { max-width: 800px; margin: 0px auto; padding: 20px 30px 40px; }
#write::after { height: 80px; }
#write > ul:first-child, #write > ol:first-child { margin-top: 30px; }
body > :first-child { margin-top: 0px !important; }
body > :last-child { margin-bottom: 0px !important; }
a { color: rgb(65, 131, 196); }
h1, h2, h3, h4, h5, h6 { position: relative; margin-top: 1rem; margin-bottom: 1rem; font-weight: bold; line-height: 1.4; -webkit-font-smoothing: antialiased; cursor: text; }
h1:hover a.anchor, h2:hover a.anchor, h3:hover a.anchor, h4:hover a.anchor, h5:hover a.anchor, h6:hover a.anchor { text-decoration: none; }
h1 tt, h1 code { font-size: inherit; }
h2 tt, h2 code { font-size: inherit; }
h3 tt, h3 code { font-size: inherit; }
h4 tt, h4 code { font-size: inherit; }
h5 tt, h5 code { font-size: inherit; }
h6 tt, h6 code { font-size: inherit; }
h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
h3 { font-size: 1.5em; line-height: 1.43; }
h4 { font-size: 1.25em; }
h5 { font-size: 1em; }
h6 { font-size: 1em; color: rgb(119, 119, 119); }
p, blockquote, ul, ol, dl, table { margin: 0.8em 0px; }
li > ol, li > ul { margin: 0px; }
hr { height: 4px; padding: 0px; margin: 16px 0px; border-width: 0px 0px 1px; border-style: none none solid; overflow: hidden; box-sizing: content-box; border-bottom-color: rgb(221, 221, 221); background-color: rgb(231, 231, 231); }
body > h2:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child { margin-top: 0px; padding-top: 0px; }
body > h1:first-child + h2 { margin-top: 0px; padding-top: 0px; }
body > h3:first-child, body > h4:first-child, body > h5:first-child, body > h6:first-child { margin-top: 0px; padding-top: 0px; }
a:first-child h1, a:first-child h2, a:first-child h3, a:first-child h4, a:first-child h5, a:first-child h6 { margin-top: 0px; padding-top: 0px; }
h1 p, h2 p, h3 p, h4 p, h5 p, h6 p { margin-top: 0px; }
li p.first { display: inline-block; }
ul, ol { padding-left: 30px; }
ul:first-child, ol:first-child { margin-top: 0px; }
ul:last-child, ol:last-child { margin-bottom: 0px; }
blockquote { border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); padding: 0px 15px; color: rgb(119, 119, 119); }
blockquote blockquote { padding-right: 0px; }
table { padding: 0px; }
table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); margin: 0px; padding: 0px; background-color: white; }
table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
table tr th { font-weight: bold; border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr td { border: 1px solid rgb(204, 204, 204); text-align: left; margin: 0px; padding: 6px 13px; }
table tr th:first-child, table tr td:first-child { margin-top: 0px; }
table tr th:last-child, table tr td:last-child { margin-bottom: 0px; }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); }
pre.md-fences, .md-fences, code, tt { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; background-color: rgb(248, 248, 248); }
pre.md-fences, .md-fences { margin-bottom: 15px; margin-top: 15px; padding: 8px 1em 6px; }
.task-list { padding-left: 0px; }
.task-list-item { padding-left: 32px; }
.task-list-item input { top: 3px; left: 8px; }
@media screen and (min-width: 914px) { 
}
@media print { 
  table, pre { page-break-inside: avoid; }
  pre { word-wrap: break-word; }
}
.md-fences { background-color: rgb(248, 248, 248); }
#write pre.md-meta-block { padding: 1rem; font-size: 85%; line-height: 1.45; border: 0px; border-radius: 3px; color: rgb(119, 119, 119); margin-top: 0px !important; background-color: rgb(247, 247, 247); }
.mathjax-block > .code-tooltip { bottom: 0.375rem; }
#write > h3.md-focus::before { left: -1.5625rem; top: 0.375rem; }
#write > h4.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h5.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
#write > h6.md-focus::before { left: -1.5625rem; top: 0.285714rem; }
.md-image > .md-meta { border: 1px solid rgb(221, 221, 221); border-radius: 3px; font-family: Consolas, 'Liberation Mono', Courier, monospace; padding: 2px 4px 0px; font-size: 0.9em; color: inherit; background-color: rgb(248, 248, 248); }
.md-tag { color: inherit; }
.md-toc { margin-top: 20px; padding-bottom: 20px; }
#typora-quick-open { border: 1px solid rgb(221, 221, 221); background-color: rgb(248, 248, 248); }
#typora-quick-open-item { border-color: rgb(254, 254, 254) rgb(229, 229, 229) rgb(229, 229, 229) rgb(238, 238, 238); border-style: solid; border-width: 1px; background-color: rgb(250, 250, 250); }


</style>
</head>
<body class='typora-export' >
<div  id='write'  class = 'is-node'><h1><a name='header-c1' class='md-header-anchor '></a>尊重知识产权，本文来自：<a href='http://blog.csdn.net/hepeng597/article/details/8782868' target='_blank' >http://blog.csdn.net/hepeng597/article/details/8782868</a></h1><p></p><blockquote><p>花了一两天时间测试和整理一下。</p><p>用net-snmp扩展MIB库，实现方法可归结为四种：</p><p>1）一是静态库方式，通过修改配置头文件，在相应地方包含新引入的mib模块的.c和.h文件，然后重新编译库文件和扩展代码；这种方式不够灵活，每次修改扩展的MIB后，都需要重新编译snmpd和扩展的代码，再重新安装snmpd到系统中。</p><p>2）二是编译动态共享库，只需把新引入的MIB模块的.c和.h文件编译成动态库，通过设置能够让代理程序载入。</p><p>对于第二种方式，一需要编译成.so动态共享库，二需要原代理程序是否包含dlmod或load命令，三还要看系统是否支持。一般情况下仅支持Unix平台。</p><p>3）三是扩展一个子代理，让SNMPD以主代理的模式运行，对于SNMPD我们只要让它启动就可以，不需要任何的更改和配置，把子代理编译生成的程序运行起来就可以扩展自定义的MIB库。</p><p>4）用shell脚本来扩展</p><p>本文我们以第三种方法在linux上开发和测试</p></blockquote><p></p><h3><a name='header-c27' class='md-header-anchor '></a>一、安装snmpd</h3><p>既然要测试，而且我们用的也是net-snmp工具，当然要先安装snmpd，本文采用5.7.2版本的snmpd，需安装net-snmp-5.7.2-1, net-snmp-devel-5.7.2-1,net-snmp-perlmods-5.7.2-1，安装可以是编译net-snmp的源码，也可以下载rpm包安装，这里略过。</p><p>安装好后测试一下service snmpd status，如果没有反应，可能是没有配置文件，可以手动建立/etc/snmp目录，在snmp目录下建立snmpd.conf文件，填入一些基本的配置信息(或者通过snmpconf程序一步一步生成,snmpconf程序比较容易懂，适合童鞋们，snmpconf会提示你创建什么配置文件，需不需要把snmpd作为主代理等等强大的提示)：</p><blockquote><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure">AخA</div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">master</span> <span class="cm-variable">agentx</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">rocommunity</span> <span class="cm-variable">public</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">rwcommunity</span> <span class="cm-variable">public</span>  </span></pre></div></div></div></div></div></div></div></pre></blockquote><p></p><p>master 是说该snmpd以主代理方式运行，目前主代理snmpd只支持agentx类型，而我们要开发的程序是一种子代理（subagent），是需要连snmpd的master agent的。rocommunity （只读对象）和rwcommunity（读写对象）的密码都是public.（这个密码就是客户端访问OID时需要提供的密码，比如在任一一个装有snmpd的linux机器上，执行snmpwalk -v2c -c public localhost 1.3.6.1.2.1.1, 这里的public就是密码，分别有只读OID密码，和读写OID密码），本文测试就以public作为默认的密码吧。现在测试一下snmpd是否正常，启动service snmpd restart，执行snmpwalk -v2c -c public localhost 1.3.6.1.2.1.1, 如果有SNMPv2-MIB:xxxx之类的输出就表示我们的主代理已经工作了。</p><p></p><h3><a name='header-c40' class='md-header-anchor '></a>二、自己的MIB库</h3><p>首先MIB库有什么用？其实作为子代理来说，在server机器上，可以不用MIB库，MIB库只为了让用户访问时方便，有了MIB库，用户就不用记那么多和长的OID，比如把MIB放在windows机器上，在windows机器装一个支持MIB的软件，用该软件打开MIB库，只要点击相应的对象就可以自动发送snmp请求到server端，所以server端是可以不要MIB库的。如果把MIB库放在linux客户端机器上，以下面自定义的MIB库为例，那么就可以直接执行snmpget -v2c -c public Test-MIB::GetTime.0，当然需要linux客户端装有snmp，而且自定义的MIB库必须能让snmpd程序找到。 </p><p>这里用就一个OID建一个MIB库来简化，命名Test-MIB.my,放在/usr/local/share/snmp/mibs目录下，因为这个目录是snmpd的默认目录，只要把MIB库放入该目录就可以自动加载MIB库，否则需要修改/etc/snmp/snmp.conf文件，添加mibs +/path/to/Test-MIB.my 并重启snmpd。</p><p>自定义MIB库，如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">--</span> <span class="cm-variable">Test</span><span class="cm-operator">-</span><span class="cm-variable">MIB</span>.<span class="cm-variable">my</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">Test</span><span class="cm-operator">-</span><span class="cm-variable">MIB</span> <span class="cm-variable">DEFINITIONS</span> ::<span class="cm-operator">=</span> <span class="cm-variable">BEGIN</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">IMPORTS</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">OBJECT</span><span class="cm-operator">-</span><span class="cm-variable">GROUP</span>, <span class="cm-variable">MODULE</span><span class="cm-operator">-</span><span class="cm-variable">COMPLIANCE</span>, <span class="cm-variable">NOTIFICATION</span><span class="cm-operator">-</span><span class="cm-variable">GROUP</span> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">FROM</span> <span class="cm-variable">SNMPv2</span><span class="cm-operator">-</span><span class="cm-variable">CONF</span> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">enterprises</span>, <span class="cm-variable">Integer32</span>, <span class="cm-variable">Unsigned32</span>, <span class="cm-variable">OBJECT</span><span class="cm-operator">-</span><span class="cm-variable">TYPE</span>, <span class="cm-variable">MODULE</span><span class="cm-operator">-</span><span class="cm-variable">IDENTITY</span>, &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">NOTIFICATION</span><span class="cm-operator">-</span><span class="cm-variable">TYPE</span> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">FROM</span> <span class="cm-variable">SNMPv2</span><span class="cm-operator">-</span><span class="cm-variable">SMI</span> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DisplayString</span> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">FROM</span> <span class="cm-variable">SNMPv2</span><span class="cm-operator">-</span><span class="cm-variable">TC</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">--</span> <span class="cm-variable">October</span> <span class="cm-number">09</span>, <span class="cm-number">2002</span> <span class="cm-variable">at</span> <span class="cm-number">14</span>:<span class="cm-number">50</span> <span class="cm-variable">GMT</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">--</span> <span class="cm-number">1.3</span>.<span class="cm-number">6.1</span>.<span class="cm-number">4.1</span>.<span class="cm-number">16535</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Test</span> <span class="cm-variable">MODULE</span><span class="cm-operator">-</span><span class="cm-variable">IDENTITY</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">LAST</span><span class="cm-operator">-</span><span class="cm-variable">UPDATED</span> <span class="cm-string">"200210091450Z"</span> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">--</span> <span class="cm-variable">October</span> <span class="cm-number">09</span>, <span class="cm-number">2002</span> <span class="cm-variable">at</span> <span class="cm-number">14</span>:<span class="cm-number">50</span> <span class="cm-variable">GMT</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">ORGANIZATION</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">""</span> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">CONTACT</span><span class="cm-operator">-</span><span class="cm-variable">INFO</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">""</span> &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DESCRIPTION</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">"Video's Server MIB."</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ::<span class="cm-operator">=</span> { <span class="cm-variable">enterprises</span> <span class="cm-number">16535</span> }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">--</span>  <span class="cm-variable">Node</span> <span class="cm-variable">definitions</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">--</span> <span class="cm-variable">This</span> <span class="cm-variable">part</span> <span class="cm-variable">will</span> <span class="cm-variable">include</span> <span class="cm-variable">all</span> <span class="cm-variable">details</span> <span class="cm-variable">about</span> <span class="cm-variable">the</span> <span class="cm-variable">Test</span>.  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">--</span> <span class="cm-number">1.3</span>.<span class="cm-number">6.1</span>.<span class="cm-number">4.1</span>.<span class="cm-number">16535.1</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Time</span> <span class="cm-variable">OBJECT</span> <span class="cm-variable">IDENTIFIER</span> ::<span class="cm-operator">=</span> { <span class="cm-variable">Test</span> <span class="cm-number">1</span> } &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-operator">--</span> <span class="cm-number">1.3</span>.<span class="cm-number">6.1</span>.<span class="cm-number">4.1</span>.<span class="cm-number">16535.1</span>.<span class="cm-number">1</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">GetTime</span> <span class="cm-variable">OBJECT</span><span class="cm-operator">-</span><span class="cm-variable">TYPE</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">SYNTAX</span> <span class="cm-def">DisplayString</span> (<span class="cm-variable">SIZE</span> (<span class="cm-number">0.</span>.<span class="cm-number">100</span>))  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">MAX</span><span class="cm-operator">-</span><span class="cm-variable">ACCESS</span> <span class="cm-variable">read</span><span class="cm-operator">-</span><span class="cm-variable">only</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">STATUS</span> <span class="cm-variable">current</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">DESCRIPTION</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-string">"Example : 2013/4/11"</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ::<span class="cm-operator">=</span> { <span class="cm-variable">Time</span> <span class="cm-number">1</span> }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">END</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">--</span> <span class="cm-variable">Test</span><span class="cm-operator">-</span><span class="cm-variable">MIB</span>.<span class="cm-variable">my</span></span></pre></div></div></div></div></div></div></div></pre><p>很简单，该MIB库只有一个OID，即：1.3.6.1.4.1.16535.1.1，写完后我们测一个MIB库有没有问题，在linux机器上用snmptranslate -Tp -IR Test-MIB::Test显示结果如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">+--</span><span class="cm-variable">Test</span>(<span class="cm-number">16535</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-operator">|</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-operator">+--</span><span class="cm-variable">Time</span>(<span class="cm-number">1</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">|</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-operator">+--</span> <span class="cm-operator">-</span><span class="cm-variable">R</span><span class="cm-operator">--</span> <span class="cm-variable">String</span> &nbsp;  <span class="cm-def">GetTime</span>(<span class="cm-number">1</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Textual</span> <span class="cm-variable">Convention</span>: <span class="cm-variable">DisplayString</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">Size</span>: <span class="cm-number">0.</span>.<span class="cm-number">100</span> </span></pre></div></div></div></div></div></div></div></pre><p>OK, snmp自动发现了这个MIB库， 有了自定义的OID，但是还没有处理程序（子代理）</p><p></p><h3><a name='header-c55' class='md-header-anchor '></a>三、生成源代码</h3><p>mib2c可以根据mib库生成对应的源代码，有多种模板，这里我们要生成子代理的代码，所以选择是固定的，执行env MIBS=&quot;+/usr/local/share/snmp/mibs/Test-MIB.my&quot; mib2c Test，会引导你逐渐生成Test.h和Test.c, 先选2再选1，过程如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[<span class="cm-variable">root@localhost</span> <span class="cm-variable">mibs</span>]<span class="cm-variable">#</span> <span class="cm-variable">env</span> <span class="cm-variable">MIBS</span><span class="cm-operator">=</span><span class="cm-string">"+/etc/snmp/mibs/Test-MIB.my"</span> <span class="cm-variable">mib2c</span> <span class="cm-variable">Test</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">writing</span> <span class="cm-variable">to</span> <span class="cm-operator">-</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">mib2c</span> <span class="cm-variable">has</span> <span class="cm-variable">multiple</span> <span class="cm-variable">configuration</span> <span class="cm-variable">files</span> <span class="cm-variable">depending</span> <span class="cm-variable">on</span> <span class="cm-variable">the</span> <span class="cm-variable">type</span> <span class="cm-variable">of</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">code</span> <span class="cm-variable">you</span> <span class="cm-variable">need</span> <span class="cm-variable">to</span> <span class="cm-variable">write</span>.  <span class="cm-variable">You</span> <span class="cm-variable">must</span> <span class="cm-variable">pick</span> <span class="cm-variable">one</span> <span class="cm-variable">depending</span> <span class="cm-variable">on</span> <span class="cm-variable">your</span> <span class="cm-variable">need</span>.  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">You</span> <span class="cm-variable">requested</span> <span class="cm-variable">mib2c</span> <span class="cm-variable">to</span> <span class="cm-variable">be</span> <span class="cm-variable">run</span> <span class="cm-variable">on</span> <span class="cm-variable">the</span> <span class="cm-variable">following</span> <span class="cm-variable">part</span> <span class="cm-variable">of</span> <span class="cm-variable">the</span> <span class="cm-variable">MIB</span> <span class="cm-variable">tree</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">OID</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-variable">Test</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">numeric</span> <span class="cm-variable">translation</span>: &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  .<span class="cm-number">1.3</span>.<span class="cm-number">6.1</span>.<span class="cm-number">4.1</span>.<span class="cm-number">16535</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">number</span> <span class="cm-variable">of</span> <span class="cm-variable">scalars</span> <span class="cm-variable">within</span>: &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-number">1</span> &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">number</span> <span class="cm-variable">of</span> <span class="cm-variable">tables</span> <span class="cm-variable">within</span>: &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-number">0</span> &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">number</span> <span class="cm-variable">of</span> <span class="cm-variable">notifications</span> <span class="cm-variable">within</span>: &nbsp; <span class="cm-number">0</span> &nbsp; &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">First</span>, <span class="cm-keyword">do</span> <span class="cm-variable">you</span> <span class="cm-variable">want</span> <span class="cm-variable">to</span> <span class="cm-variable">generate</span> <span class="cm-variable">code</span> <span class="cm-variable">that</span> <span class="cm-variable">is</span> <span class="cm-variable">compatible</span> <span class="cm-variable">with</span> <span class="cm-variable">the</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">ucd</span><span class="cm-operator">-</span><span class="cm-variable">snmp</span> <span class="cm-number">4.</span><span class="cm-variable">X</span> <span class="cm-variable">line</span> <span class="cm-variable">of</span> <span class="cm-variable">code</span>, <span class="cm-variable">or</span> <span class="cm-variable">code</span> <span class="cm-keyword">for</span> <span class="cm-variable">the</span> <span class="cm-variable">newer</span> <span class="cm-variable">Net</span><span class="cm-operator">-</span><span class="cm-variable">SNMP</span> <span class="cm-number">5.</span><span class="cm-variable">X</span> <span class="cm-variable">code</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">base</span> (<span class="cm-variable">which</span> <span class="cm-variable">provides</span> <span class="cm-variable">a</span> <span class="cm-variable">much</span> <span class="cm-variable">greater</span> <span class="cm-variable">choice</span> <span class="cm-variable">of</span> <span class="cm-variable">APIs</span> <span class="cm-variable">to</span> <span class="cm-variable">pick</span> <span class="cm-variable">from</span>):  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-number">1</span>) <span class="cm-variable">ucd</span><span class="cm-operator">-</span><span class="cm-variable">snmp</span> <span class="cm-variable">style</span> <span class="cm-variable">code</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-number">2</span>) <span class="cm-variable">Net</span><span class="cm-operator">-</span><span class="cm-variable">SNMP</span> <span class="cm-variable">style</span> <span class="cm-variable">code</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Select</span> <span class="cm-variable">your</span> <span class="cm-variable">choice</span> : <span class="cm-number">2</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">**********************************************************************</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">GENERATING</span> <span class="cm-variable">CODE</span> <span class="cm-variable">FOR</span> <span class="cm-variable">SCALAR</span> <span class="cm-variable">OBJECTS</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">**********************************************************************</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">It</span> <span class="cm-variable">looks</span> <span class="cm-variable">like</span> <span class="cm-variable">you</span> <span class="cm-variable">have</span> <span class="cm-variable">some</span> <span class="cm-variable">scalars</span> <span class="cm-variable">in</span> <span class="cm-variable">the</span> <span class="cm-variable">mib</span> <span class="cm-variable">you</span> <span class="cm-variable">requested</span>, <span class="cm-variable">so</span> <span class="cm-variable">I</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">will</span> <span class="cm-variable">now</span> <span class="cm-variable">generate</span> <span class="cm-variable">code</span> <span class="cm-keyword">for</span> <span class="cm-variable">them</span> <span class="cm-keyword">if</span> <span class="cm-variable">you</span> <span class="cm-variable">wish</span>.  <span class="cm-variable">You</span> <span class="cm-variable">have</span> <span class="cm-variable">two</span> <span class="cm-variable">choices</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">for</span> <span class="cm-variable">scalar</span> <span class="cm-variable">API</span> <span class="cm-variable">styles</span> <span class="cm-variable">currently</span>.  <span class="cm-variable">Pick</span> <span class="cm-variable">between</span> <span class="cm-variable">them</span>, <span class="cm-variable">or</span> <span class="cm-variable">choose</span> <span class="cm-variable">not</span> &nbsp; </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">to</span> <span class="cm-variable">generate</span> <span class="cm-variable">any</span> <span class="cm-variable">code</span> <span class="cm-keyword">for</span> <span class="cm-variable">the</span> <span class="cm-variable">scalars</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-number">1</span>) <span class="cm-variable">If</span> <span class="cm-variable">you</span><span class="cm-string">'re writing code for some generic scalars  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; (<span class="cm-variable">by</span> <span class="cm-variable">hand</span> <span class="cm-variable">use</span>: <span class="cm-string">"mib2c -c mib2c.scalar.conf Test"</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-number">2</span>) <span class="cm-variable">If</span> <span class="cm-variable">you</span> <span class="cm-variable">want</span> <span class="cm-variable">to</span> <span class="cm-variable">magically</span> <span class="cm-string">"tie"</span> <span class="cm-variable">integer</span> <span class="cm-variable">variables</span> <span class="cm-variable">to</span> <span class="cm-variable">integer</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-variable">scalars</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; (<span class="cm-variable">by</span> <span class="cm-variable">hand</span> <span class="cm-variable">use</span>: <span class="cm-string">"mib2c -c mib2c.int_watch.conf Test"</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-number">3</span>) <span class="cm-variable">Don</span><span class="cm-string">'t generate any code for the scalars  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Select</span> <span class="cm-variable">your</span> <span class="cm-variable">choice</span>: <span class="cm-number">1</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">using</span> <span class="cm-variable">the</span> <span class="cm-variable">mib2c</span>.<span class="cm-variable">scalar</span>.<span class="cm-variable">conf</span> <span class="cm-variable">configuration</span> <span class="cm-variable">file</span> <span class="cm-variable">to</span> <span class="cm-variable">generate</span> <span class="cm-variable">your</span> <span class="cm-variable">code</span>.  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">writing</span> <span class="cm-variable">to</span> <span class="cm-variable">Test</span>.<span class="cm-variable">h</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">writing</span> <span class="cm-variable">to</span> <span class="cm-variable">Test</span>.<span class="cm-variable">c</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">**********************************************************************</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">*</span> <span class="cm-variable">NOTE</span> <span class="cm-variable">WELL</span>: <span class="cm-variable">The</span> <span class="cm-variable">code</span> <span class="cm-variable">generated</span> <span class="cm-variable">by</span> <span class="cm-variable">mib2c</span> <span class="cm-variable">is</span> <span class="cm-variable">only</span> <span class="cm-variable">a</span> <span class="cm-variable">template</span>.  <span class="cm-operator">*</span><span class="cm-variable">YOU</span><span class="cm-operator">*</span>  <span class="cm-operator">*</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">*</span> <span class="cm-variable">must</span> <span class="cm-variable">fill</span> <span class="cm-variable">in</span> <span class="cm-variable">the</span> <span class="cm-variable">code</span> <span class="cm-variable">before</span> <span class="cm-variable">it</span><span class="cm-string">'ll work most of the time.  In many *  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">*</span> <span class="cm-variable">cases</span>, <span class="cm-variable">spots</span> <span class="cm-variable">that</span> <span class="cm-variable">MUST</span> <span class="cm-variable">be</span> <span class="cm-variable">edited</span> <span class="cm-variable">within</span> <span class="cm-variable">the</span> <span class="cm-variable">files</span> <span class="cm-variable">are</span> <span class="cm-variable">marked</span> <span class="cm-variable">with</span>  <span class="cm-operator">*</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">*</span> <span class="cm-comment">/* XXX */</span> <span class="cm-variable">or</span> <span class="cm-comment">/* TODO */</span> <span class="cm-variable">comments</span>. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-operator">*</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-operator">**********************************************************************</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">running</span> <span class="cm-variable">indent</span> <span class="cm-variable">on</span> <span class="cm-variable">Test</span>.<span class="cm-variable">h</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">running</span> <span class="cm-variable">indent</span> <span class="cm-variable">on</span> <span class="cm-variable">Test</span>.<span class="cm-variable">c</span></span></pre></div></div></div></div></div></div></div></pre><p>mib2c已经统计出我们的mib库包含1个scalar变量，0个table变量，0个通知变量，Scalar就是包含我们常用的整型，字符串，时间等等数据类型。table就是scalar的一种集合，有一个和多个列组成，类似于数据库中的表。它必须具有索引项，用来按一定顺序检索表项，当然我们只写了一个标量的OID，不是表结构也不是通知结构生成的Test.h如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* Note: this file originally auto-generated by mib2c using </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp;  $ </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifndef TEST_H  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#define TEST_H  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* function declarations  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-def">init_Test</span>(<span class="cm-variable-3">void</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">Netsnmp_Node_Handler</span> <span class="cm-variable">handle_GetTime</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="cm-comment">/* TEST_H */</span>  </span></pre></div></div></div></div></div></div></div></pre><p>生成的Test.c文件如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* Note: this file originally auto-generated by mib2c using </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp;  $ </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/net-snmp-config.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/net-snmp-includes.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include "Test.h"  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/** Initializes the Test module */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">init_Test</span>(<span class="cm-variable-3">void</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">const</span> <span class="cm-variable">oid</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">GetTime_oid</span>[] <span class="cm-operator">=</span> { <span class="cm-number">1</span>, <span class="cm-number">3</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>, <span class="cm-number">16535</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span> };  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEBUGMSGTL</span>((<span class="cm-string">"Test"</span>, <span class="cm-string">"Initializing\n"</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">netsnmp_register_scalar</span>(<span class="cm-variable">netsnmp_create_handler_registration</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-string">"GetTime"</span>, <span class="cm-variable">handle_GetTime</span>, <span class="cm-variable">GetTime_oid</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">OID_LENGTH</span>(<span class="cm-variable">GetTime_oid</span>), <span class="cm-variable">HANDLER_CAN_RONLY</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">int</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">handle_GetTime</span>(<span class="cm-variable">netsnmp_mib_handler</span> <span class="cm-operator">*</span><span class="cm-variable">handler</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_handler_registration</span> <span class="cm-operator">*</span><span class="cm-variable">reginfo</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_agent_request_info</span> <span class="cm-operator">*</span><span class="cm-variable">reqinfo</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_request_info</span> <span class="cm-operator">*</span><span class="cm-variable">requests</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* We are never called for a GETNEXT if it's registered as a </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* "instance", as it's "magically" handled for us. &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* a instance handler also only hands us one request at a time, so </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* we don't need to loop over a list of requests; we'll only get one.  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span> (<span class="cm-variable">reqinfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mode</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">MODE_GET</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snmp_set_var_typed_value</span>(<span class="cm-variable">requests</span><span class="cm-operator">-&gt;</span><span class="cm-variable">requestvb</span>, <span class="cm-variable">ASN_OCTET_STR</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">* XXX: a pointer to the scalar's data  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">*/</span> ,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">* XXX: the length of the data in bytes  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">*/</span> );  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">default</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">* we should never get here, so this is a really bad error  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snmp_log</span>(<span class="cm-variable">LOG_ERR</span>, <span class="cm-string">"unknown mode (%d) in handle_GetTime\n"</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">reqinfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mode</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">SNMP_ERR_GENERR</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">SNMP_ERR_NOERROR</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div></div></div></pre><p>以上的代码都是自动生成的，我们没有写一行代码，到了这一步，我们需要把Test.c里面的 XXX改成自己的值，也就两行，修改后Test.c文件代码如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* Note: this file originally auto-generated by mib2c using </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp;  $ </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/net-snmp-config.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/net-snmp-includes.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include "Test.h"  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;time.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/** Initializes the Test module */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">init_Test</span>(<span class="cm-variable-3">void</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">const</span> <span class="cm-variable">oid</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">GetTime_oid</span>[] <span class="cm-operator">=</span> { <span class="cm-number">1</span>, <span class="cm-number">3</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>, <span class="cm-number">16535</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span> };  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEBUGMSGTL</span>((<span class="cm-string">"Test"</span>, <span class="cm-string">"Initializing\n"</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">netsnmp_register_scalar</span>(<span class="cm-variable">netsnmp_create_handler_registration</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-string">"GetTime"</span>, <span class="cm-variable">handle_GetTime</span>, <span class="cm-variable">GetTime_oid</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">OID_LENGTH</span>(<span class="cm-variable">GetTime_oid</span>), <span class="cm-variable">HANDLER_CAN_RONLY</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">int</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">handle_GetTime</span>(<span class="cm-variable">netsnmp_mib_handler</span> <span class="cm-operator">*</span><span class="cm-variable">handler</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_handler_registration</span> <span class="cm-operator">*</span><span class="cm-variable">reginfo</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_agent_request_info</span> <span class="cm-operator">*</span><span class="cm-variable">reqinfo</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_request_info</span> <span class="cm-operator">*</span><span class="cm-variable">requests</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* We are never called for a GETNEXT if it's registered as a </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* "instance", as it's "magically" handled for us. &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* a instance handler also only hands us one request at a time, so </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* we don't need to loop over a list of requests; we'll only get one.  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">time_t</span> <span class="cm-variable">t</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span> (<span class="cm-variable">reqinfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mode</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">MODE_GET</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">time</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable-3">char</span> <span class="cm-variable">szTime</span>[<span class="cm-number">100</span>];  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snprintf</span>(<span class="cm-variable">szTime</span>,<span class="cm-number">100</span>,<span class="cm-string">"%s"</span>,<span class="cm-variable">ctime</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snmp_set_var_typed_value</span>(<span class="cm-variable">requests</span><span class="cm-operator">-&gt;</span><span class="cm-variable">requestvb</span>, <span class="cm-variable">ASN_OCTET_STR</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">* XXX: a pointer to the scalar's data  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">*/</span> <span class="cm-variable">szTime</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">* XXX: the length of the data in bytes  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">*/</span> <span class="cm-variable">strlen</span>(<span class="cm-variable">szTime</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">default</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">* we should never get here, so this is a really bad error  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snmp_log</span>(<span class="cm-variable">LOG_ERR</span>, <span class="cm-string">"unknown mode (%d) in handle_GetTime\n"</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">reqinfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mode</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">SNMP_ERR_GENERR</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">SNMP_ERR_NOERROR</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre></div></div></div></div></div></div></div></pre><p>简单吧，现在子代理程序基本就写完了，我们执行命令让我们的子代理生成可执行程序，执行net-snmp-config --compile-subagent Test Test.c，生成了Test程序， 执行过程如下：</p><p>简单吧，现在子代理程序基本就写完了，我们执行命令让我们的子代理生成可执行程序，执行net-snmp-config --compile-subagent Test Test.c，生成了Test程序， 执行过程如下：
可以看出来，net-snmp-config程序生成了一个临时的C文件，netsnmptmp.12373.c 并与Test.c一起编译，生成了Test程序后又删除了该临时文件。我们会在最后研究netsnmptmp.12373.c文件。</p><p></p><h3><a name='header-c75' class='md-header-anchor '></a>四、测试一下</h3><p>现在Test程序已经生成了，我们先执行主代理（service snmpd start）,再执行子代理./Test,再ps -ef | grep Test，看一下，可以看到Test程序自动在后台启动了，如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[root@localhost hepeng]<span class="cm-comment"># ps -ef| grep Test &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;">root &nbsp; &nbsp; <span class="cm-number">27526</span> &nbsp; &nbsp; <span class="cm-number">1</span>  <span class="cm-number">0</span> <span class="cm-number">13</span>:29 ? &nbsp; &nbsp; &nbsp;  <span class="cm-number">00</span>:00:00 ./Test  </span></pre><pre class=""><span style="padding-right: 0.1px;">root &nbsp; &nbsp; <span class="cm-number">27531</span> <span class="cm-number">27448</span>  <span class="cm-number">0</span> <span class="cm-number">13</span>:29 pts/2 &nbsp;  <span class="cm-number">00</span>:00:00 <span class="cm-builtin">grep</span> Test </span></pre></div></div></div></div></div></div></div></pre><p>到这里我们可以想象到,Test.c文件中是没有main函数的，那么main函数肯定是在netsnmptmp.12373.c 中，net-snmp-config让Test程序变成了守护进程在后台运行。到此我们的service端就已经布置完成了，子代理理论上可以回复自定义的GetTime OID的请求。本文在一台装有snmpd和子代理的linux server机器上直接测试。执行命令如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[root@localhost hepeng]<span class="cm-comment"># snmpget -v2c -c public localhost 1.3.6.1.4.1.16535.1.1.0  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">SNMPv2-SMI::enterprises.16535.1.1.0 <span class="cm-operator">=</span> STRING: <span class="cm-string">"Thu Apr 11 13:40:20 2013  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">"  </span></span></pre></div></div></div></div></div></div></div></pre><p>可以看到，我们开发的子代理成功工作了。如果自定义的MIB库已经加入到snmpd指定的目录中，我们可以执行</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[hepeng@localhost ~]<span class="cm-def">$ snmpget</span> <span class="cm-attribute">-v2c</span> <span class="cm-attribute">-c</span> public localhost Test-MIB:GetTime.0  </span></pre><pre class=""><span style="padding-right: 0.1px;">Test-MIB::GetTime.0 <span class="cm-operator">=</span> STRING: Thu Apr <span class="cm-number">11</span> <span class="cm-number">13</span>:46:42 <span class="cm-number">2013</span>  </span></pre></div></div></div></div></div></div></div></pre><p>snmpget会自动在所有的MIB库中查找Test-MIB库，并把Test-MIB:GetTime.0转换成1.3.6.1.4.1.16535.1.1.0并发送get请求。现在子代理是已经开发成功了，我们实际上只写了两三行代码就开发了net-snmp子代理，是不是很简单呢？现在有个问题，怎么加入到我们自己的项目中呢？因为Test.c中并没有main函数，在一个项目中直接调用init_Test()能不能让子代理work呢？那就要研究一下netsnmptmp.12373.c。</p><p></p><h3><a name='header-c89' class='md-header-anchor '></a>五、加入项目中</h3><p>我们再次执行net-snmp-config --compile-subagent Test Test.c，然后立刻Ctrl+c,时间要控制好，让net-snmp-config程序产生了临时的C文件，却没有删除它。打开netsnmptmp.12373.c，我们来看一下代码，200多行，本文只贴上main函数的重要部分，代码中都添加了注释，不难理解：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span> (<span class="cm-variable-3">int</span> <span class="cm-variable">argc</span>, <span class="cm-variable-3">char</span> <span class="cm-variable-3">**</span><span class="cm-variable">argv</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">int</span> <span class="cm-variable">arg</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">char*</span> <span class="cm-variable">cp</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable-3">int</span> <span class="cm-variable">dont_fork</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>, <span class="cm-variable">do_help</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">while</span> ((<span class="cm-variable">arg</span> <span class="cm-operator">=</span> <span class="cm-variable">getopt</span>(<span class="cm-variable">argc</span>, <span class="cm-variable">argv</span>, <span class="cm-string">"dD:fhHL:"</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifndef DISABLE_MIB_LOADING  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"m:M:"</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif </span><span class="cm-comment">/* DISABLE_MIB_LOADING */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"n:"</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifndef DISABLE_MIB_LOADING  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"P:"</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif </span><span class="cm-comment">/* DISABLE_MIB_LOADING */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-string">"vx:"</span>)) <span class="cm-operator">!=</span> <span class="cm-variable">EOF</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span> (<span class="cm-variable">arg</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-string">'D'</span>:<span class="cm-comment">/*这里省略多个case break,只是一些选项，没必要研究/ </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">break; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">default: </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">fprintf(stderr, "invalid option: -%c\n", arg); </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">usage(argv[0]); </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-comment">break; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">} </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">} </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">if (do_help) { </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">netsnmp_ds_set_boolean(NETSNMP_DS_APPLICATION_ID, </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">NETSNMP_DS_AGENT_NO_ROOT_ACCESS, 1); </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">} else { </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* we are a subagent  第一步：这里是告诉snmpd我们这个Test作为子代理*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">netsnmp_ds_set_boolean</span>(<span class="cm-variable">NETSNMP_DS_APPLICATION_ID</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">NETSNMP_DS_AGENT_ROLE</span>, <span class="cm-number">1</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> (<span class="cm-operator">!</span><span class="cm-variable">dont_fork</span>) {<span class="cm-comment">/* 这里是让Test程序变成守护进程，执行Test后可以在后台运行不会退出 */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-keyword">if</span> (<span class="cm-variable">netsnmp_daemonize</span>(<span class="cm-number">1</span>, <span class="cm-variable">snmp_stderrlog_status</span>()) <span class="cm-operator">!=</span> <span class="cm-number">0</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">exit</span>(<span class="cm-number">1</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* initialize tcpip, if necessary */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">SOCK_STARTUP</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* initialize the agent library 第二步*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">init_agent</span>(<span class="cm-variable">app_name</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* initialize your mib code here 第三步*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">init_Test</span>();  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* Test will be used to read Test.conf files. 第四步 */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">init_snmp</span>(<span class="cm-string">"Test"</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">if</span> (<span class="cm-variable">do_help</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">fprintf</span>(<span class="cm-variable">stderr</span>, <span class="cm-string">"Configuration directives understood:\n"</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">read_config_print_usage</span>(<span class="cm-string">"  "</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">exit</span>(<span class="cm-number">0</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* In case we received a request to stop (kill -TERM or kill -INT) */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">netsnmp_running</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifdef SIGTERM  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">signal</span>(<span class="cm-variable">SIGTERM</span>, <span class="cm-variable">stop_server</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifdef SIGINT  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">signal</span>(<span class="cm-variable">SIGINT</span>, <span class="cm-variable">stop_server</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#ifdef SIGHUP  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">signal</span>(<span class="cm-variable">SIGHUP</span>, <span class="cm-variable">hup_handler</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#endif  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* main loop here... */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-keyword">while</span>(<span class="cm-variable">netsnmp_running</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">if</span> (<span class="cm-variable">reconfig</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">free_config</span>();  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">read_configs</span>();  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp;  <span class="cm-variable">reconfig</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">agent_check_and_process</span>(<span class="cm-number">1</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* at shutdown time */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">snmp_shutdown</span>(<span class="cm-variable">app_name</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* deinitialize your mib code here */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-comment">/* shutdown the agent library */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">shutdown_agent</span>();  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">SOCK_CLEANUP</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  <span class="cm-variable">exit</span>(<span class="cm-number">0</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre></div></div></div></div></div></div></div></pre><p>我们不管上面代码那些看不懂的函数，知道大概意思就行，现在我们来加入到自己的项目中，找到项目中的main函数，在main函数中添加初始化Test子代理的代码，本文为了方便理解，就在Test.c中添加main函数，就地取材，写个超简单函数，不考虑传入参数。修改后的Test.c文件如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* Note: this file originally auto-generated by mib2c using </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">* &nbsp; &nbsp; &nbsp;  $ </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/net-snmp-config.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/net-snmp-includes.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;net-snmp/agent/net-snmp-agent-includes.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include "Test.h"  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;time.h&gt;  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-comment">/** Initializes the Test module */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">void</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">init_Test</span>(<span class="cm-variable-3">void</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">const</span> <span class="cm-variable">oid</span> &nbsp; &nbsp; &nbsp; <span class="cm-variable">GetTime_oid</span>[] <span class="cm-operator">=</span> { <span class="cm-number">1</span>, <span class="cm-number">3</span>, <span class="cm-number">6</span>, <span class="cm-number">1</span>, <span class="cm-number">4</span>, <span class="cm-number">1</span>, <span class="cm-number">16535</span>, <span class="cm-number">1</span>, <span class="cm-number">1</span> };  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">DEBUGMSGTL</span>((<span class="cm-string">"Test"</span>, <span class="cm-string">"Initializing\n"</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">netsnmp_register_scalar</span>(<span class="cm-variable">netsnmp_create_handler_registration</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  (<span class="cm-string">"GetTime"</span>, <span class="cm-variable">handle_GetTime</span>, <span class="cm-variable">GetTime_oid</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">OID_LENGTH</span>(<span class="cm-variable">GetTime_oid</span>), <span class="cm-variable">HANDLER_CAN_RONLY</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">int</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-def">handle_GetTime</span>(<span class="cm-variable">netsnmp_mib_handler</span> <span class="cm-operator">*</span><span class="cm-variable">handler</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_handler_registration</span> <span class="cm-operator">*</span><span class="cm-variable">reginfo</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_agent_request_info</span> <span class="cm-operator">*</span><span class="cm-variable">reqinfo</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">netsnmp_request_info</span> <span class="cm-operator">*</span><span class="cm-variable">requests</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* We are never called for a GETNEXT if it's registered as a </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* "instance", as it's "magically" handled for us. &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* a instance handler also only hands us one request at a time, so </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">* we don't need to loop over a list of requests; we'll only get one.  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">time_t</span> <span class="cm-variable">t</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">switch</span> (<span class="cm-variable">reqinfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mode</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">case</span> <span class="cm-variable">MODE_GET</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">time</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable-3">char</span> <span class="cm-variable">szTime</span>[<span class="cm-number">100</span>];  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-variable">snprintf</span>(<span class="cm-variable">szTime</span>,<span class="cm-number">100</span>,<span class="cm-string">"%s"</span>,<span class="cm-variable">ctime</span>(<span class="cm-operator">&amp;</span><span class="cm-variable">t</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snmp_set_var_typed_value</span>(<span class="cm-variable">requests</span><span class="cm-operator">-&gt;</span><span class="cm-variable">requestvb</span>, <span class="cm-variable">ASN_OCTET_STR</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">* XXX: a pointer to the scalar's data  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">*/</span> <span class="cm-variable">szTime</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">* XXX: the length of the data in bytes  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  <span class="cm-comment">*/</span> <span class="cm-variable">strlen</span>(<span class="cm-variable">szTime</span>));  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">break</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">default</span>:  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-comment">/* </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">* we should never get here, so this is a really bad error  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-comment">*/</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">snmp_log</span>(<span class="cm-variable">LOG_ERR</span>, <span class="cm-string">"unknown mode (%d) in handle_GetTime\n"</span>,  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="cm-variable">reqinfo</span><span class="cm-operator">-&gt;</span><span class="cm-variable">mode</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">SNMP_ERR_GENERR</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  }  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp;  <span class="cm-keyword">return</span> <span class="cm-variable">SNMP_ERR_NOERROR</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-keyword">static</span> <span class="cm-variable-3">int</span> <span class="cm-variable">keep_running</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable">RETSIGTYPE</span> <span class="cm-def">stop_server</span>(<span class="cm-variable-3">int</span> <span class="cm-def">__attribute__</span>((<span class="cm-variable">unused</span>)) <span class="cm-variable">a</span>) {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">keep_running</span> <span class="cm-operator">=</span> <span class="cm-number">0</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-def">main</span>()  </span></pre><pre class=""><span style="padding-right: 0.1px;">{  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">const</span> <span class="cm-variable-3">char</span> <span class="cm-variable-3">*</span><span class="cm-variable">app_name</span> <span class="cm-operator">=</span> <span class="cm-string">"Test"</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* we are a subagent */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">netsnmp_ds_set_boolean</span>(<span class="cm-variable">NETSNMP_DS_APPLICATION_ID</span>, <span class="cm-variable">NETSNMP_DS_AGENT_ROLE</span>, <span class="cm-number">1</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* initialize the agent library */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">init_agent</span>(<span class="cm-variable">app_name</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* initialize your mib code here */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">init_Test</span>();  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* Test will be used to read Test.conf files. */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">init_snmp</span>(<span class="cm-string">"Test"</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">keep_running</span> <span class="cm-operator">=</span> <span class="cm-number">1</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">while</span>(<span class="cm-variable">keep_running</span>)  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; {  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  <span class="cm-variable">agent_check_and_process</span>(<span class="cm-number">1</span>);<span class="cm-comment">/* block every 1 second */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; }  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* at shutdown time */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">snmp_shutdown</span>(<span class="cm-variable">app_name</span>);  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* deinitialize your mib code here */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;">  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-comment">/* shutdown the agent library */</span>  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-variable">shutdown_agent</span>();  </span></pre><pre class=""><span style="padding-right: 0.1px;"> &nbsp; <span class="cm-keyword">return</span> <span class="cm-number">0</span>;  </span></pre><pre class=""><span style="padding-right: 0.1px;">}  </span></pre></div></div></div></div></div></div></div></pre><p>这个main函数是不是很简单呢？当snmpd stop的时候会调用stop_server,也就会注销我们的子代理。编译一下，这里我们不用net-snmp-config编译，因为是要加入到自己的项目中，所以推荐写入到Makefile中，本文就不写Makefile了，直接调用gcc命令生成（直接用net-snmp-config的参数就可以），如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[root@localhost hepeng]<span class="cm-comment"># gcc  -fno-strict-aliasing -g -O2 -Ulinux -Dlinux=linux  -D_REENTRANT -D_GNU_SOURCE -fno-strict-aliasing -pipe -Wdeclaration-after-statement -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64 -I/usr/include/gdbm  -I/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi/CORE &nbsp; -I. -I/usr/local/include -o Test Test.c  -L/usr/local/lib -lnetsnmpmibs -lnetsnmpagent -lnetsnmp -lnetsnmpmibs -lpci -lrpm -lrpmdb -lrpmio &nbsp; -lnetsnmpagent  -Wl,-E -Wl,-rpath,/usr/lib64/perl5/5.8.8/x86_64-linux-thread-multi/CORE -lnetsnmp  -lcrypto  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">Test.c: In <span class="cm-keyword">function</span> ‘handle_GetTime’:  </span></pre><pre class=""><span style="padding-right: 0.1px;">Test.c:45: warning: ISO C90 forbids mixed declarations and code  </span></pre></div></div></div></div></div></div></div></pre><p>然后我们启动snmpd，再执行Test程序，程序会block住，因为不是守护进程嘛，而且main有循环，如下：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[root@video6 ~]<span class="cm-comment"># ./Test &nbsp; </span></span></pre><pre class=""><span style="padding-right: 0.1px;">NET-SNMP version <span class="cm-number">5</span>.7.2 AgentX subagent connected  </span></pre></div></div></div></div></div></div></div></pre><p>我们再调用snmpget来测试结果：</p><pre class="md-fences"><div class="code-tooltip md-tooltip-hide" align="right"></div> <div class="CodeMirror cm-s-inner CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 4px;"></div><div class="CodeMirror-hscrollbar" style="left: 0px;"></div><div class="CodeMirror-vscrollbar"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-height: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-code"><pre class=""><span style="padding-right: 0.1px;">[root@localhost hepeng]<span class="cm-comment"># snmpget -v2c -c public localhost 1.3.6.1.4.1.16535.1.1.0  </span></span></pre><pre class=""><span style="padding-right: 0.1px;">SNMPv2-SMI::enterprises.16535.1.1.0 <span class="cm-operator">=</span> STRING: <span class="cm-string">"Thu Apr 11 02:39:17 2013  </span></span></pre><pre class=""><span style="padding-right: 0.1px;"><span class="cm-string">"  </span></span></pre></div></div></div></div></div></div></div></pre><p></p><h2><a name='header-c107' class='md-header-anchor '></a>六、总结</h2><p>子代理看起来非常好写，我们实际上就写了两三行，其它的函数看不懂也没关系， 不用深入了解，拷贝过来直接用，能编译过就行，一般看函数名字就知道怎么用。</p><p>子代理官方参考：<a href='http://www.net-snmp.org/wiki/index.php/TUT:Writing_a_Subagent' target='_blank' >http://www.net-snmp.org/wiki/index.php/TUT:Writing_a_Subagent</a></p><p>动态库扩展MIB库方法：<a href='http://www.net-snmp.org/wiki/index.php/TUT:Writing_a_Dynamically_Loadable_Object' target='_blank' >http://www.net-snmp.org/wiki/index.php/TUT:Writing_a_Dynamically_Loadable_Object</a></p><p>shell脚本扩展MIB库方法：<a href='http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts' target='_blank' >http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts</a></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>